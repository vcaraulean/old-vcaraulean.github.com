
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Silverlight 4 quirks: OOB and loading MainWindow size/position - valeriu caraulean</title>
	<meta name="author" content="Valeriu Caraulean">

	
	<meta name="description" content="Silverlight 4 Quirks: OOB and Loading MainWindow Size/position Since we’re writing an Out-Of-Browser Silverlight application, we want it to look &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="valeriu caraulean" type="application/atom+xml">
	
	<link rel="canonical" href="http://caraulean.com/blog/2010/10/12/silverlight-4-quirks-oob-and-loading-mainwindow-sizeposition/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><!-- Don't want the pic in header

<div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>

-->

<hgroup>
  <h1>
    <a href="/"> valeriu caraulean</a>
  </h1>
</hgroup>

<p class="subtitle">keep it simple, it will work...</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/vcaraulean" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/vcaraulean" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Silverlight 4 Quirks: OOB and Loading MainWindow Size/position</h1>
	<div class="entry-content" itemprop="articleBody"><p>Since we’re writing an Out-Of-Browser Silverlight application, we want it to look and behave like a normal windows app. One of the first things I’m adding to new apps, is saving Window’s position and size and reloading them when application starts next time. So, when user launches the app again, it will find the app same size and position as before</p>

<p>In WPF that’s done pretty straightforward and it just works! For Silverlight 4 it took me already half of the day, and it’s not done yet&#8230;</p>

<p>To save MainWindow’s position and size in Silverlight 4 you can attach to MainWindow’s Closing event where you can pick values for current size and position. Then, when loading app next time, in Application’s Startup event we can <em>try load </em>previous values.</p>

<p>Where’s the catch? Width and Height are set properly, while setting Left and Top properties has NO EFFECT. Then, if the window is “snapped” to margins (in Windows 7,  maximized for full screen&#8217;s  height, leaving width the same) it will not be able to restore to previous  height, saying that value is out of bounds.</p>

<p>The code, very simple and straightforward:</p>

<pre><code>public class MainWindowSettings
{
    public static void Initialize()
    {
        if(!Application.Current.IsRunningOutOfBrowser)
            return;
        if (!Application.Current.HasElevatedPermissions)
            return;
        Initialize(Application.Current.MainWindow);
    }
    private static void Initialize(Window mainWindow)
    {
        var appSettings = new ApplicationSettings();
        var settings = appSettings.Read&lt;Settings&gt;(Settings.Key, null);
        if (settings != null)
        {
            mainWindow.WindowState = settings.WindowState;
            if (settings.WindowState != WindowState.Maximized)
            {
                mainWindow.Height = settings.Height;
                mainWindow.Width = settings.Width;
                mainWindow.Top = settings.Top;
                mainWindow.Left = settings.Left;
            }
        }
        mainWindow.Closing += (sender, args) =&gt;
        {
            var windowSettings = new Settings
            {
                Height = mainWindow.Height,
                Width = mainWindow.Width,
                Top =  mainWindow.Top,
                Left = mainWindow.Left,
                WindowState = mainWindow.WindowState
            };
            new ApplicationSettings().Write(Settings.Key, windowSettings);
        };
    }
    public class Settings
    {
        public const string Key = "MainWindowSettings";
        public Settings()
        {
            WindowState = WindowState.Normal;
        }
        public double Width { get; set; }
        public double Height { get; set; }
        public double Top { get; set; }
        public double Left { get; set; }
        public WindowState WindowState { get; set; }
    }
}
</code></pre>

<p>Anybody have a clue? An advice, other than “wait Silverlight v. Next”?</p>

<p><strong>Update</strong>: I&#8217;ve copy/pasted this code in new empty app and discovered that saving Top&amp;Left values is working as it should. But the problem with &#8220;snap&#8221; is still here. Googling it revealed that <a href="http://forums.silverlight.net/forums/p/204612/479374.aspx">I&#8217;m not alone</a> facing this <a href="http://forums.silverlight.net/forums/p/199966/466463.aspx">issue</a>. So, waiting Silverlight v. Next&#8230;</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Valeriu Caraulean -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'caraulean';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://caraulean.com/blog/2010/10/12/silverlight-4-quirks-oob-and-loading-mainwindow-sizeposition/';
        var disqus_url = 'http://caraulean.com/blog/2010/10/12/silverlight-4-quirks-oob-and-loading-mainwindow-sizeposition/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-21974825-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
