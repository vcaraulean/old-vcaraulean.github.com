
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>How to reference platform specific (x86/x64) assemblies in Visual Studio projects - valeriu caraulean</title>
	<meta name="author" content="Valeriu Caraulean">

	
	<meta name="description" content="How to Reference Platform Specific (X86/x64) Assemblies in Visual Studio Projects Let’s say you have a third party library that you want to &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="valeriu caraulean" type="application/atom+xml">
	
	<link rel="canonical" href="http://caraulean.com/blog/2010/04/12/how-to-reference-platform-specific-x86x64-assemblies-in-visual-studio-projects/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><!-- Don't want the pic in header

<div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>

-->

<hgroup>
  <h1>
    <a href="/"> valeriu caraulean</a>
  </h1>
</hgroup>

<p class="subtitle">keep it simple, it will work...</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/vcaraulean" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/vcaraulean" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">How to Reference Platform Specific (X86/x64) Assemblies in Visual Studio Projects</h1>
	<div class="entry-content" itemprop="articleBody"><p>Let’s say you have a third party library that you want to reference from your project. By default platform target in Visual Studio is &#8221;<strong>Any CPU</strong>&#8221;. But the library is compiled for specific target – <strong>x86</strong> or <strong>x64</strong>. When you’re working in a team, have a build server and all of them is in different platforms you’ll start to have issues. Like, project with an x64 referenced assembly working ok on your x64 machine and failing on x86 computers and so on.</p>

<p>For us it was the “<strong>System.Data.SQLite</strong>” – the <a href="http://sqlite.phxsoftware.com/">ADO.NET provider for SQLite</a>. It is provided compiled separately for 32 and 64 bit systems. It was not easy to figure out how to manage references to SQLite provider without making too much changes in our projects and build scripts.</p>

<p>I’ve found an elegant solution for it: manually modifying project files that are using it to add a conditional elements to <Project> node. Look at this code:</p>

<pre><code>  &lt;Choose&gt;
    &lt;When Condition="$(PROCESSOR_ARCHITECTURE) == 'AMD64' Or $(PROCESSOR_ARCHITEW6432) == 'AMD64'"&gt;
      &lt;ItemGroup&gt;
        &lt;Reference Include="System.Data.SQLite, Version=1.0.65.0, Culture=neutral, PublicKeyToken=db937bc2d44ff139, processorArchitecture=AMD64"&gt;
          &lt;SpecificVersion&gt;False&lt;/SpecificVersion&gt;
          &lt;HintPath&gt;..\Lib\x64\System.Data.SQLite.DLL&lt;/HintPath&gt;
        &lt;/Reference&gt;
      &lt;/ItemGroup&gt;
    &lt;/When&gt;
    &lt;Otherwise&gt;
      &lt;ItemGroup&gt;
        &lt;Reference Include="System.Data.SQLite, Version=1.0.65.0, Culture=neutral, PublicKeyToken=db937bc2d44ff139, processorArchitecture=x86"&gt;
          &lt;SpecificVersion&gt;False&lt;/SpecificVersion&gt;
          &lt;HintPath&gt;..\Lib\x86\System.Data.SQLite.DLL&lt;/HintPath&gt;
        &lt;/Reference&gt;
      &lt;/ItemGroup&gt;
    &lt;/Otherwise&gt;
  &lt;/Choose&gt;
</code></pre>

<p><code>&lt;Choose&gt; &lt;When Condition= … /&gt; &lt;Otherwise … /&gt; &lt;/Choose&gt;</code> – it’s fun how people are trying to add “behavior” to a such static thing as XML. Well, it works, sometimes…</p>

<p>Detection of the current platform is based on checking of two environment variables: PROCESSOR_ARCHITECTURE and PROCESSOR_ARCHITEW6432 to detect “bitness” of running OS/processes. Details of this you can find in the post of David Wang <a href="http://blogs.msdn.com/david.wang/archive/2006/03/26/HOWTO-Detect-Process-Bitness.aspx">HOWTO: Detect Process Bitness</a>.</p>

<p>Working like a charm for us.</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Valeriu Caraulean -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'caraulean';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://caraulean.com/blog/2010/04/12/how-to-reference-platform-specific-x86x64-assemblies-in-visual-studio-projects/';
        var disqus_url = 'http://caraulean.com/blog/2010/04/12/how-to-reference-platform-specific-x86x64-assemblies-in-visual-studio-projects/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-21974825-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
